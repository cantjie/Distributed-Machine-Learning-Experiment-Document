FROM ubuntu:18.04

WORKDIR /opt/pytorch

RUN apt -y update && apt -y install wget curl vim libgcrypt20 coreutils libgl1-mesa-glx

RUN wget https://repo.continuum.io/miniconda/Miniconda3-py39_23.3.1-0-Linux-x86_64.sh -O ./miniconda.sh

RUN chmod ouga+xw ./miniconda.sh
RUN bash ./miniconda.sh -b -p ./miniconda

ENV PATH /opt/pytorch/miniconda/bin:$PATH

RUN conda update conda
RUN conda create -n deep-learning python=3.9

RUN eval "$(conda shell.bash hook)"

# RUN conda activate deep-learning
# RUN conda install mkl


# RUN conda activate deep-learning && conda install mkl numpy pandas jupyter ipython scikit-learn plotly
# RUN conda activate deep-learning && conda install pytorch torchvision -c pytorch
# RUN conda activate deep-learning && conda install -c conda-forge matplotlib opencv seaborn

# RUN /bin/bash -c "source activate deep-learning && conda install mkl"

RUN /bin/bash -c "source activate deep-learning && conda install mkl numpy pandas jupyter ipython scikit-learn plotly"
RUN /bin/bash -c "source activate deep-learning && conda install pytorch torchvision -c pytorch"
RUN /bin/bash -c "source activate deep-learning && conda install -c conda-forge matplotlib opencv seaborn"

COPY run.sh run.sh
RUN chmod ouga+x run.sh

EXPOSE 8888

ENTRYPOINT ["bash", "./run.sh"]
# ENTRYPOINT ["tail", "-f", "/dev/null"]